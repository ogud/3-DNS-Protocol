<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE rfc SYSTEM 'rfc2629.dtd' []>
<rfc ipr="trust200902" category="std" docName="draft-ietf-regext-dnsoperator-to-rrr-protocol-01.txt">
<?rfc toc="yes"?>
<?rfc symrefs="yes"?>
<?rfc sortrefs="yes"?>
<?rfc compact="yes"?>
<?rfc subcompact="no"?>
<?rfc private=""?>
<?rfc topblock="yes"?>
<?rfc comments="no"?>
<front>
<title abbrev="3-DNS-RRR">Third Party DNS operator to Registrars/Registries Protocol</title>

<author initials="J." surname="Latour" fullname="Jacques Latour">
<organization>CIRA</organization>
<address>
<postal>
<street></street>
<city></city>
<code></code>
<country></country>
<region></region>
</postal>
<phone></phone>
<email>jacques.latour@cira.ca</email>
<uri></uri>
</address>
</author>
<author initials="O." surname="Gudmundsson" fullname="Olafur Gudmundsson">
<organization>Cloudflare, Inc.</organization>
<address>
<postal>
<street></street>
<city></city>
<code></code>
<country></country>
<region></region>
</postal>
<phone></phone>
<email>olafur+ietf@cloudflare.com</email>
<uri></uri>
</address>
</author>
<author initials="P." surname="Wouters" fullname="Paul Wouters">
<organization>Red Hat</organization>
<address>
<postal>
<street></street>
<city></city>
<code></code>
<country></country>
<region></region>
</postal>
<phone></phone>
<email>paul@nohats.ca</email>
<uri></uri>
</address>
</author>
<author initials="M." surname="Pounsett" fullname="Matthew Pounsett">
<organization>Rightside Group, Ltd.</organization>
<address>
<postal>
<street></street>
<city></city>
<code></code>
<country></country>
<region></region>
</postal>
<phone></phone>
<email>matt@conundrum.com</email>
<uri></uri>
</address>
</author>
<date year="2017" month="January" day="4"/>

<area>Applications</area>
<workgroup>regext</workgroup>
<keyword>dnssec</keyword>
<keyword>delegation maintenance</keyword>
<keyword>trust anchors</keyword>


<abstract>
<t>There are several problems that arise in the standard
Registrant/Registrar/Registry model when the operator of a zone is neither the
Registrant nor the Registrar for the delegation. Historically the issues have
been minor, and limited to difficulty guiding the Registrant through the
initial changes to the NS records for the delegation. As this is usually a
one time activity when the operator first takes charge of the zone it has not
been treated as a serious issue.
</t>
<t>When the domain hand uses DNSSEC it necessary to make regular (sometimes
annual) changes to the delegation, updating DS record(s) in order to track KSK
rollover.  Under the current model this is prone to delays and errors, as the
registrant must participate in updates to DS records.
</t>
<t>This document describes a simple protocol that allows a third party DNS
operator to update DS and NS records for a delegation, in a trusted manner,
without involving the registrant for each operation. This same protocol can be
used by Registrants.
</t>
</abstract>


</front>

<middle>

<section anchor="introduction" title="Introduction">
<t>After a domain has been registered, one of three parties will maintain the DNS
zone loaded on the &quot;primary&quot; DNS servers: the Registrant, the Registrar, or a
third party DNS operator.  DNS registration systems were originally designed
around making registrations easy and fast, however after registration the
complexity of making changes to the delegation differs for each of these
parties.  The Registrar can make changes directly in the Registry systems
through some API (typically EPP <xref target="RFC5730"/>).  The Registrant is typically
limited to using a web interface supplied by the Registrar.  A third party DNS
Operator must to go through the Registrant to update any delegation
information.
</t>
<t>In this last case, the operator must contact and engage the Registrant in
updating NS and DS records for the delegation.  New information must be
communicated to the registrant, who must submit that information to the
Registrar.  Typically this involves cutting and pasting between email and a
web interface, which is error prone.  Furthermore, involving Registrants in
this way does not scale for even moderately sized DNS operators. Tracking
thousands (or millions) of changes sent to customers, and following up if
those changes are not submitted to the Registrar, or are submitted with
errors, is itself expensive and error prone.
</t>
<t>The current system does not work well, as there are many types of failures
that have been reported at all levels in the registration model.  The failures
result in either the inability to use DNSSEC or in validation failures that
cause the domain to become unavailable to users behind validating resolvers.
</t>
<t>The goal of this document is to create a protocol for establishing a secure
chain of trust that involves parties not in the traditional
Registrant/Registrar/Registry (RRR) model, and to reduce the friction in
maintaining DNSSEC secured delegations in these cases.  It describes a
REST-based <xref target="RFC6690"/> protocol which can be used to establish DNSSEC initial
trust (to enable or bootstrap DNSSEC), and to trigger maintenance of
delegation records such as DS, NS, and glue records.
</t>
</section>

<section anchor="notional-conventions" title="Notional Conventions">

<section anchor="definitions" title="Definitions">
<t>For the purposes of this draft, a third-party DNS Operator is any DNS Operator
responsible for a zone, where the operator is neither the Registrant nor the
Registrar of record for the delegation.
</t>
<t>Uses of &quot;child&quot; and &quot;parent&quot; refer to the relationship between DNS zone
operators.  In this document, unless otherwise noted, the child is the
third-party DNS operator and the parent is the Registry.
</t>
<t>Uses of the words &quot;Registrar&quot; or &quot;Registration Entity&quot; in this document may
also be applied to Resellers or to Registries that engage in registration
activities directly with Registrants.  Unless otherwise noted, they are used
to refer to the entity which has a direct business relationship with the
Registrant.
</t>
</section>

<section anchor="rfc2119-keywords" title="RFC2119 Keywords">
<t>The key words &quot;MUST&quot;, &quot;MUST NOT&quot;, &quot;REQUIRED&quot;, &quot;SHALL&quot;, &quot;SHALL NOT&quot;, &quot;SHOULD&quot;,
&quot;SHOULD NOT&quot;, &quot;RECOMMENDED&quot;, &quot;MAY&quot;, and &quot;OPTIONAL&quot; in this document are to be
interpreted as described in <xref target="RFC2119"/>.
</t>
</section>
</section>

<section anchor="process-overview" title="Process Overview">

<section anchor="identifying-the-registrar" title="Identifying the Registrar">
<t>As of publication of this document, there has never been a standardized or
widely deployed method for easily and scalably identifying the Registar for a
particular registration.
</t>
<t>At this time, WHOIS <xref target="RFC3912"/> is the only widely deployed protocol to carry
such information, but WHOIS responses are unstructured text, and each
implementor can lay out its text responses differently.  In addition,
Registries may include referrals in this unstructured text to the WHOIS
interfaces of their Registrars, and those Registrar WHOIS interface in turn
have their own layouts.  This presents a text parsing problem which is
infeasible to solve.
</t>
<t>RDAP, the successor to WHOIS, described in <xref target="RFC7480"/>, solves the problems of
unstructured responses, and a consistently implemented referral system,
however at this time RDAP has yet to be deployed at most Registries.
</t>
<t>With no current mechanism in place to scalably discover the Registar for a
particular registration, the problem of automatic discovery of the base URL
of the API is considered out of scope of this document.  The authors recommend
standardization of an RDAP extension to obtain this information from the
Registry.
</t>
</section>

<section anchor="establishing-a-chain-of-trust" title="Establishing a Chain of Trust">
<t>After signing the zone, the child operator needs to upload the DS record(s) to
the parent.  The child can signal its desire to have DNSSEC validation enabled
by publishing one of the special DNS records CDS and/or CDNSKEY as defined in
<xref target="RFC7344"/> and <xref target="I-D.ietf-dnsop-maintain-ds"/>.
</t>
<t><list style="empty">
<t>[RFC Editor: The above I-D reference should be replaced with the correct
RFC number upon publication.]
</t>
</list></t>
<t>In the case of an insecure delegation, the parent will normally not be
scanning the child zone for CDS/CDNSKEY records.  The child operator can use
this protocol to notify the parent to begin such a scan.
</t>
<t>Once the parent sees these records it SHOULD start acceptance processing.
</t>
</section>

<section anchor="maintaining-the-chain-of-trust" title="Maintaining the Chain of Trust">
<t>One the secure chain of trust is established, the parent SHOULD regularly
check the child zone for CDS/CDNSKEY record changes.  The parent SHOULD also
accept signals via this protocol to immediately check the child zone for
CDS/CDNSKEY records.
</t>
<t>Server implementations of this protocol MAY include rate limiting to protect
their systems and the systems of child operators from abuse.
</t>
<t>Each parent operator is responsible for developing, implementing, and
communicating their DNSSEC maintenance policies.
</t>
</section>

<section anchor="other-delegation-maintenance" title="Other Delegation Maintenance">
<t><list style="empty">
<t>[ Not yet defined ]
</t>
</list></t>
</section>

<section anchor="acceptance-processing" title="Acceptance Processing">
<t>The parent, upon receiving a signal or detecting through polling that the
child desires to have its delegation updated, SHOULD run a series of tests to
ensure that updating the parent zone will not create or exacerbate any
problems with the child zone. The basic tests SHOULD include:
</t>
<t>
<list style="symbols">
<t>checking that the child zone is is properly signed as per the parent
DNSSEC policy</t>
<t>if updating the DS record, checking that the child CDS RRset references a
KSK which is present in the child DNSKEY RRset and signs the CDS RRset</t>
<t>ensuring all name servers in the apex NS RRset of the child zone agree on
the apex NS RRset and CDS RRset contents</t>
</list>
</t>
<t>The parent operator SHOULD NOT make any changes to the DS RRset if the child
name servers do not agree on the CDS/CDNSKEY content.
</t>
<t><list style="empty">
<t>[NOTE: Do we need a new section in the DPS for the CDS management policy
<xref target="RFC6841"/>?]
</t>
</list></t>
<t>Parents MAY require compliance with additional tests, particularly in the case
of establishing a new chain of trust, such as:
</t>
<t>
<list style="symbols">
<t>checking that all child name servers to respond with a consistent
CDS/CDNSKEY RRset for a number of queries over an extended period of time
to minimise the possibility of an attacker spoofing responses</t>
<t>requiring the child name servers to respond with identical CDS/CDNSKEY
RRsets over TCP</t>
<t>ensuring zone delegation best practices (for examples, see
<xref target="I-D.wallstrom-dnsop-dns-delegation-requirements"/></t>
<t>requiring the child operator to prove they can add data to the zone (for
example, by publishing a particular token)

<vspace/></t>
</list>
</t>
</section>
</section>

<section anchor="api-definition" title="API Definition">
<t>This protocol is partially synchronous, meaning the server can elect to hold
connections open until operations have completed, or it can return a status
code indicating that it has received a request, and close the connection.  It
is up to the child to monitor the parent for completion of the operation, and
issue possible follow-up calls.
</t>
<t>Clients may be denied access to change the DS records for domains that are
Registry Locked (HTTP Status code 401).  Registry Lock is a mechanism
provided by certain Registries or Registrars that prevents domain hijacking by
ensuring no attributes of the domain are changeable, and no transfer or
deletion transactions can be processed against the domain name without manual
intervention.
</t>

<section anchor="authentication" title="Authentication">
<t>The API does not impose any unique server authentication requirements. The
server authentication provided by TLS fully addresses the needs of this
protocol. The API MUST be provided over TLS-protected transport (e.g., HTTPS)
or VPN.
</t>
<t>Client authentication is considered out of scope of this document.  The
publication of CDS/CDNSKEY records in the child zone is an indication that the
child operator intends to perform DS-record-updating activities (add/delete)
in the parent zone.  Since this protocol is simply a signal to the Registrar
that they should examine the child zone for such intentions, additional
authentication of the client making the request is considered unnecessary.
</t>
<t>Registrars MAY implement their own policy to protect acces to the API, such as
with IP whitelisting, client TLS certificates, etc..  Registrars SHOULD take
steps to ensure that a lack of additional authentication does not open up a
denial of service mechanism against the systems of the Registrar, the
Registry, or the child operator.
</t>
</section>

<section anchor="restful-resources" title="RESTful Resources">
<t>In the following text, &quot;{domain}&quot; is the child zone to be operated on.
</t>

<section anchor="cds-resource" title="CDS resource">
<t>Path: /domains/{domain}/cds
</t>

<section anchor="establishing-initial-trust-enabling-dnssec" title="Establishing Initial Trust (Enabling DNSSEC)">

<section anchor="request" title="Request">
<t>Syntax: POST /domains/{domain}/cds
</t>
<t>Request that an initial set of DS records based on the CDS record in the child
zone be inserted into the registry and the parent zone upon the successful
completion of the request. If there are multiple CDS records in the CDS RRset,
multiple DS records will be added.
</t>
</section>

<section anchor="response" title="Response">
<t>
<list style="symbols">
<t>HTTP Status code 201 indicates a success.</t>
<t>HTTP Status code 400 indicates a failure due to validation.</t>
<t>HTTP Status code 401 indicates an unauthorized resource access.</t>
<t>HTTP Status code 403 indicates a failure due to an invalid challenge token.</t>
<t>HTTP Status code 404 indicates the domain does not exist.</t>
<t>HTTP Status code 409 indicates the delegation already has a DS RRset.</t>
<t>HTTP Status code 429 indicates the client has been rate-limited.</t>
<t>HTTP Status code 500 indicates a failure due to unforeseeable reasons.</t>
</list>
</t>
<t>This request is for setting up initial trust in the delegation.  The parent
SHOULD return a status code 409 if it already has a DS RRset for the child
zone.
</t>
<t>Upon receipt of a 403 response the child operator SHOULD issue a POST for the
&quot;token&quot; resource to fetch a challenge token to insert into the zone.
</t>
</section>
</section>

<section anchor="removing-ds-records" title="Removing DS Records">

<section anchor="request-1" title="Request">
<t>Syntax: DELETE /domains/{domain}/cds
</t>
<t>Request that the parent check for a null CDS or CDNSKEY record in the child
zone, indicating a request that the entire DS RRset be removed.  This will
make the delegation insecure.
</t>
</section>

<section anchor="response-1" title="Response">
<t>
<list style="symbols">
<t>HTTP Status code 200 indicates a success.</t>
<t>HTTP Status code 400 indicates a failure due to validation.</t>
<t>HTTP Status code 401 indicates an unauthorized resource access.</t>
<t>HTTP Status code 404 indicates the domain does not exist.</t>
<t>HTTP Status code 412 indicates the parent does not have a DS RRset</t>
<t>HTTP Status code 429 indicates the client has been rate-limited.</t>
<t>HTTP Status code 500 indicates a failure due to unforeseeable reasons.</t>
</list>
</t>
</section>
</section>

<section anchor="modifying-ds-records" title="Modifying DS Records">

<section anchor="request-2" title="Request">
<t>Syntax: PUT /domains/{domain}/cds
</t>
<t>Request that the parent modify the DS RRset based on the CDS/CDNSKEY available
in the child zone.  As a result of this request the parent SHOULD add or
delete DS records as indicated by the CDS/CDNSKEY RRset, but MUST NOT delete
the entire DS RRset.
</t>
</section>

<section anchor="response-2" title="Response">
<t>
<list style="symbols">
<t>HTTP Status code 200 indicates a success.</t>
<t>HTTP Status code 400 indicates a failure due to validation.</t>
<t>HTTP Status code 401 indicates an unauthorized resource access.</t>
<t>HTTP Status code 404 indicates the domain does not exist.</t>
<t>HTTP Status code 412 indicates the parent does not have a DS RRset</t>
<t>HTTP Status code 429 indicates the client has been rate-limited.</t>
<t>HTTP Status code 500 indicates a failure due to unforeseeable reasons.</t>
</list>
</t>
</section>
</section>
</section>

<section anchor="token-resource" title="Token resource">
<t>Path: /domains/{domain}/token
</t>

<section anchor="establish-initial-trust-with-challenge" title="Establish Initial Trust with Challenge">

<section anchor="request-3" title="Request">
<t>Syntax: POST /domains/{domain}/token
</t>
<t>The DNSSEC policy of the parent operator may require proof that the DNS
Operator is in control of the domain.  The token API call returns a random
token to be included as a TXT record for the _delegate.@ domain name (where @
is the apex of the child zone) prior establishing the DNSSEC initial trust.
This is an additional trust control mechanism to establish the initial chain
of trust.
</t>
<t>Once the child operator has received a token, it SHOULD be inserted in the
zone and the operator SHOULD proceed with a POST of the cds resource.
</t>
<t>Note that the _delegate TXT record is publicly available and not a secret
token.
</t>
</section>

<section anchor="response-3" title="Response">
<t>
<list style="symbols">
<t>HTTP Status code 200 indicates a success.  A token is included in the
 body of the response, as a valid TXT record</t>
<t>HTTP Status code 404 indicates the domain does not exist.</t>
<t>HTTP Status code 500 indicates a failure due to unforeseeable reasons.</t>
</list>
</t>
</section>
</section>
</section>
</section>

<section anchor="customized-error-messages" title="Customized Error Messages">
<t>Registrars MAY provide a customized error message in the response body in
addition to the HTTP status code defined in the previous section.  This
response MAY include an identifying number/string that can be used to track
the request.
</t>
</section>
</section>

<section anchor="security-considerations" title="Security considerations">
<t>When zones are properly provisioned, and delegations follow standards and best
practices (e.g. <xref target="I-D.wallstrom-dnsop-dns-delegation-requirements"/>), the
Registrar or Registry can trust the DNS information it receives from multiple
child name servers, over time, and/or over TCP to establish the initial chain
of trust.
</t>
<t>In addition, the Registrar or Registry can require the DNS Operator to prove
they control the zone by requiring the child operator to navigate additional
hurdles, such as adding a challenge token to the zone.
</t>
<t>This protocol should increase the adoption of DNSSEC, enabling more zones to
become validated thus overall the security gain outweighs the possible
drawbacks.
</t>
<t>Registrants and DNS Operators always have the option to establish the chain of
trust in band via the standard Registrant/Registrar/Registry model.
</t>
</section>

<section anchor="iana-actions" title="IANA Actions">
<t>This document has no actions for IANA
</t>
</section>

<section anchor="internationalization-considerations" title="Internationalization Considerations">
<t>This protocol is designed for machine to machine communications.  Clients and
servers should use punycode <xref target="RFC3492"/> when operating on internationalized
domain names.
</t>
</section>

</middle>
<back>
<references title="Normative References">
<?rfc include="http://xml2rfc.ietf.org/public/rfc/bibxml3/reference.I-D.ietf-dnsop-maintain-ds.xml"?>
<?rfc include="http://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.3492.xml"?>
<?rfc include="http://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.6690.xml"?>
<?rfc include="http://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.7344.xml"?>
</references>
<references title="Informative References">
<?rfc include="http://xml2rfc.ietf.org/public/rfc/bibxml3/reference.I-D.wallstrom-dnsop-dns-delegation-requirements.xml"?>
<?rfc include="http://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.2119.xml"?>
<?rfc include="http://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.3912.xml"?>
<?rfc include="http://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.5730.xml"?>
<?rfc include="http://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.6841.xml"?>
<?rfc include="http://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.7480.xml"?>
</references>

<section anchor="document-history" title="Document History">

<section anchor="regext-version-03-not-yet-published" title="regext Version 03 (not yet published)">
<t>
<list style="symbols">
<t>simplify abstract</t>
<t>move all justification text to Intro</t>
<t>added HTTP response codes for rate limiting (429), missing DS RRsets
(412)</t>
<t>expanded on Internationalization Considerations</t>
<t>corrected informative/normative document references</t>
<t>general spelling/grammar/style cleanup</t>
</list>
</t>
</section>

<section anchor="regext-version-02" title="regext Version 02">
<t>
<list style="symbols">
<t>Clarified based on comments and questions from early implementors (JL)</t>
<t>Text edits and clarifications.</t>
</list>
</t>
</section>

<section anchor="regext-version-01" title="regext Version 01">
<t>
<list style="symbols">
<t>Rewrote Abstract and Into (MP)</t>
<t>Introduced code 401 when changes are not allowed</t>
<t>Text edits and clarifications.</t>
</list>
</t>
</section>

<section anchor="regext-version-00" title="regext Version 00">
<t>
<list style="symbols">
<t>Working group document same as 03, just track changed to standard</t>
</list>
</t>
</section>

<section anchor="version-03" title="Version 03">
<t>
<list style="symbols">
<t>Clarified based on comments and questions from early implementors</t>
</list>
</t>
</section>

<section anchor="version-02" title="Version 02">
<t>
<list style="symbols">
<t>Reflected comments on mailing lists</t>
</list>
</t>
</section>

<section anchor="version-01" title="Version 01">
<t>
<list style="symbols">
<t>This version adds a full REST definition this is based on suggestions from
Jakob Schlyter.</t>
</list>
</t>
</section>

<section anchor="version-00" title="Version 00">
<t>
<list style="symbols">
<t>First rough version</t>
</list>
</t>
</section>
</section>

</back>
</rfc>
